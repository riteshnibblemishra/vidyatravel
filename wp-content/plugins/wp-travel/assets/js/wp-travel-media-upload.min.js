!function($){function wp_travel_set_gallery_featured_image(id){$(".wp-travel-open-uploaded-images ul").children().removeClass("featured-image"),$("#wp_travel_thumbnail_id").val(id),$("#wp-travel-gallery-image-list-"+id).addClass("featured-image")}function wp_travel_update_gallery_listing(data){var template=wp.template("my-template");$(".wp-travel-open-uploaded-images ul").append(template(data)),wp_travel_update_gallery_ids(data);var thumbnail_id=wp_travel_drag_drop_uploader._thumbnail_id;(1>thumbnail_id||void 0==thumbnail_id)&&(thumbnail_id=$(".wp-travel-open-uploaded-images ul li:first").data("attachmentid")),wp_travel_set_gallery_featured_image(thumbnail_id)}function wp_travel_update_gallery_ids(data){var gallery_ids=[];if($(".wp-travel-open-uploaded-images ul li").each(function(){gallery_ids.push($(this).data("attachmentid"))}),data.length>0){var thumbnail_id=wp_travel_drag_drop_uploader._thumbnail_id;1>thumbnail_id&&(thumbnail_id=$(".wp-travel-open-uploaded-images ul li:first").data("attachmentid")),wp_travel_set_gallery_featured_image(thumbnail_id),$.each(data,function(index,val){gallery_ids.push(parseInt(val.id))})}gallery_ids=gallery_ids.filter(Boolean);var unique=gallery_ids.filter(function(elem,index,self){return index==self.indexOf(elem)});""!=gallery_ids?($(".wp-travel-post-tab-content-section-title").show(),$(".wp-travel-open-uploaded-images .description").show()):($(".wp-travel-post-tab-content-section-title").hide(),$(".wp-travel-open-uploaded-images .description").hide()),$("#wp_travel_gallery_ids").val(unique.join(","))}$(function(){if(void 0!==wp_travel_drag_drop_uploader.gallery_data){wp_travel_update_gallery_listing(wp_travel_drag_drop_uploader.gallery_data)}else $(".wp-travel-post-tab-content-section-title").hide();if($(".wp-travel-open-uploaded-images ul").sortable({update:function(){wp_travel_update_gallery_ids([])}}),$(document).on("click",".wp-travel-open-uploaded-images ul li",function(){wp_travel_set_gallery_featured_image($(this).data("attachmentid"))}),$(document).on("click",".wp-travel-open-uploaded-images ul li span",function(){if(!confirm("sure to delete?"))return!1;var parent=$(this).parent(),attachmentid=parent.data("attachmentid"),featured_id=$("#wp_travel_thumbnail_id").val();parent.fadeOut("slow",function(){if($(this).remove(),featured_id==attachmentid){wp_travel_set_gallery_featured_image($(".wp-travel-open-uploaded-images ul li:first").data("attachmentid"))}wp_travel_update_gallery_ids([])})}),$(".wp-travel-open-uploader").wpTravelUploader({media_options:{multiple:!0},onSelect:function(mediaUploader){attachments=mediaUploader.state().get("selection").toJSON(),wp_travel_update_gallery_listing(attachments)}}),"undefined"!=typeof uploader){$("input#plupload-browse-button").val(wp_travel_drag_drop_uploader.labels.uploader_files_computer);var envira_bar=$(".wp-travel-upload-progress-bar"),envira_progress=$(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-inner"),envira_status=$(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-status"),wp_travel_upload_error=$("#wp-travel-upload-error"),envira_file_count=0;uploader.bind("FilesAdded",function(up,files){$(wp_travel_upload_error).html(""),envira_file_count=files.length,$(".uploading .current",$(envira_status)).text("1"),$(".uploading .total",$(envira_status)).text(envira_file_count),$(".uploading",$(envira_status)).show(),$(".done",$(envira_status)).hide(),$(envira_bar).fadeIn()}),uploader.bind("UploadProgress",function(up,file){$(".uploading .current",$(envira_status)).text(envira_file_count-up.total.queued+1),$(envira_progress).css({width:up.total.percent+"%"})}),uploader.bind("FileUploaded",function(up,file,info){info.response.replace(/^<pre>(\d+)<\/pre>$/,"$1").match(/media-upload-error|error-div/)?$(wp_travel_upload_error).html(info.response):$.post(wp_travel_drag_drop_uploader.ajax,{action:"envira_gallery_load_image",nonce:wp_travel_drag_drop_uploader.drag_drop_nonce,id:info.response},function(res){wp_travel_update_gallery_listing([res])},"json")}),uploader.bind("UploadComplete",function(){$(".uploading",$(envira_status)).hide(),$(".done",$(envira_status)).show(),setTimeout(function(){$(envira_bar).fadeOut()},1e3)}),uploader.bind("Error",function(up,err){$(wp_travel_upload_error).html('<div class="error fade"><p>'+err.file.name+": "+err.message+"</p></div>"),up.refresh()})}})}(jQuery);